import { CodeSurfer } from 'code-surfer'
import { nightOwl } from "@code-surfer/themes"

export const theme = nightOwl

# Let's make a Promise

Or: _How I learned to stop using callbacks and love the `Promise` implementation_

---

## Required knowledge

- Common data types (primitives, arrays, and objects)
- Functions, particularly as a first class data type

---

## A refresher on First Class Functions

<CodeSurfer>

```js
setTimeout(() => {
  console.log('Hello, world!')
}, 1000)
```

```js 1[1:11],3[8]
setTimeout(() => {
  console.log('Hello, world!')
}, 1000)
```

```js 1[12:19],2,3[1]
setTimeout(() => {
  console.log('Hello, world!')
}, 1000)
```

```js 3[4:7]
setTimeout(() => {
  console.log('Hello, world!')
}, 1000)
```

```js 1[12:19],2,3[1]
setTimeout(() => {
  console.log('Hello, world!')
}, 1000)
```

```js 1[18:24],2,3[1]
const sayHello = () => {
  console.log('Hello, world!')
}

setTimeout(sayHello, 1000)
```

```js
const sayHello = () => {
  console.log('Hello, world!')
}

setTimeout(sayHello, 1000)
```

```js 5[22:25]
const sayHello = () => {
  console.log('Hello, world!')
}

setTimeout(sayHello, 1000)
```

```js 5,7[22:28]
const sayHello = () => {
  console.log('Hello, world!')
}

const timeout = 1000

setTimeout(sayHello, timeout)
```

```js
const sayHello = () => {
  console.log('Hello, world!')
}

const timeout = 1000

setTimeout(sayHello, timeout)
```

</CodeSurfer>

<Notes>

In JavaScript, functions are First Class Citizens. I.e. they can be passed around like all other data types.

</Notes>

---

<CodeSurfer>

```js
setTimeout(() => {
  console.log('Hello, world!')
}, 1000)
```

</CodeSurfer>

is equivalent to

<CodeSurfer>

```js
const sayHello = () => {
  console.log('Hello, world!')
}

const timeout = 1000

setTimeout(sayHello, timeout)
```

</CodeSurfer>

---

## What this won't cover

- `async`/`await`
- A lot of the extra features that the `Promise` implementation offers
- Why leaves are usually green

<Notes>

- async/await is certainly useful, but a solid understanding of Promises is what you really need to leverage it properly
- Promise.all, Promise.race, Promise.any (though I challenge you to implement these yourself after today's talk)

</Notes>

---

## Okay, so what's a Promise?

<Steps>

> “The `Promise` object represents the **eventual completion (or failure)** of an asynchronous operation and its **resulting value**.”
– MDN

</Steps>

<Notes>

- That's spot on. But also pretty useless on its own

</Notes>

---

## What does that look like in action?

<CodeSurfer>

```js
eventualGreeting()
  .then(console.log)
  .catch(console.error)

// eventually logs "Hello, world!", or logs an error
```

</CodeSurfer>

---

## How does a Promise get created?

<CodeSurfer>

```js
new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve('Hello, world!')
  }, 1000)
})
```

```js 1[1:12],5[2]
new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve('Hello, world!')
  }, 1000)
})
```

```js 1[13:34],5[1]
new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve('Hello, world!')
  }, 1000)
})
```

```js 1[22:43],5[1] subtitle="Let's give that function a name"
const promiseLogic = (resolve, reject) => {
  setTimeout(() => {
    resolve('Hello, world!')
  }, 1000)
}

new Promise(promiseLogic)
```

```js 1[7:18],7[13:24] subtitle="Let's give that function a name"
const promiseLogic = (resolve, reject) => {
  setTimeout(() => {
    resolve('Hello, world!')
  }, 1000)
}

new Promise(promiseLogic)
```

```js 2:4 subtitle="This should look familiar"
const promiseLogic = (resolve, reject) => {
  setTimeout(() => {
    resolve('Hello, world!')
  }, 1000)
}

new Promise(promiseLogic)
```

```js 1[23:29],3
const promiseLogic = (resolve, reject) => {
  setTimeout(() => {
    resolve('Hello, world!')
  }, 1000)
}

new Promise(promiseLogic)
```

```js
const promiseLogic = (resolve, reject) => {
  setTimeout(() => {
    resolve('Hello, world!')
  }, 1000)
}

new Promise(promiseLogic)
```

```js 7 subtitle="This will immediately create the Promise and execute promiseLogic"
const promiseLogic = (resolve, reject) => {
  setTimeout(() => {
    resolve('Hello, world!')
  }, 1000)
}

new Promise(promiseLogic)
```

```js 7 subtitle="So let's wrap a function around it so it won't do anything until we call it"
const promiseLogic = (resolve, reject) => {
  setTimeout(() => {
    resolve('Hello, world!')
  }, 1000)
}

const eventualGreeting = () => new Promise(promiseLogic)
```

```js
const promiseLogic = (resolve, reject) => {
  setTimeout(() => {
    resolve('Hello, world!')
  }, 1000)
}

const eventualGreeting = () => new Promise(promiseLogic)

eventualGreeting()
  .then(console.log)
  .catch(console.error)
```

</CodeSurfer>

<Notes>

- Whatever you call `resolve` with becomes what the `Promise` resolves with. In this case, a string

</Notes>

---

# Extra features of Promises

---

### A Promise always returns a Promise

<Notes>

- Let's assume we have a function which returns a Promise which adds one to whatever we give it, after one second.

</Notes>

<CodeSurfer>

```js
eventuallyAddOne(5)
  .then(console.log)

// Eventually gives us 6
```

```js title="Wow this is awful"
eventuallyAddOne(5)
  .then((resultOne) => {
    eventuallyAddOne(resultOne)
      .then((resultTwo) => {
        eventuallyAddOne(resultTwo)
          .then((resultThree) => {
            console.log(resultThree)
          })
      })
  })

// Eventually gives us 8
```

```js title="This is fair bit better"
eventuallyAddOne(5)
  .then((result) => eventuallyAddOne(result))
  .then((result) => eventuallyAddOne(result))
  .then(console.log)

// Eventually gives us 8
```

```js title="This makes me happy"
eventuallyAddOne(5)
  .then(eventuallyAddOne)
  .then(eventuallyAddOne)
  .then(console.log)

// Eventually gives us 8
```

</CodeSurfer>

---

### No, really, a Promise _always_ returns a Promise

<Notes>

- Let's assume we have a _synchronous_ function which subtracts two

</Notes>

<CodeSurfer>

```js
const takeTwo = (input) => input - 2
```

```js
const takeTwo = (input) => input - 2

eventuallyAddOne(5)
  .then(takeTwo)
  .then(console.log)

// Eventually gives us 4
```

```js title="You could be here for a while. You get the idea."
eventuallyAddOne(5)
  .then(takeTwo)
  .then(takeTwo)
  .then(eventuallyAddOne)
  .then(takeTwo)
  .then(eventuallyAddOne)
  .then(console.log)
```

</CodeSurfer>

---

Thanks!
